


void make_hlt_SF(){

    double eta_bins[] = {0., 1.44, 2.5};
    // Eta_1
    double xval[] =   {27.5,28.5,29.5,30.5,31.5,32.5,33.5,34.5,35.5,37,39,42,47,55,80,150};



    //2016
    /*
    int n_bins = 23;
   //Double_t pt_val[23] = {20.5,21.5,22.5,23.5,24.5,25.5,26.5,27.5,28.5,29.5,30.5,31.5,32.5,33.5,34.5,35.5,37,39,42,47,55,80,150,};
   //Double_t pt_ler2[23] = {0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,1,1,2,3,5,20,50,};
    double pt_bins[]=  {20, 21, 22, 23, 24, 25, 26, 27., 28., 29., 30., 31., 32., 33., 34., 35., 36,38,40,44,50,60,100, 200};  

   Double_t MCef_val[23] = {0.000443688,0.000467455,0.000786726,0.00108882,0.00398584,0.0270899,0.213474,0.564873,0.695733,0.740566,0.763781,0.786793,0.801033,0.811176,0.813197,0.821875,0.828629,0.839828,0.855152,0.869712,0.899131,0.925594,0.953686,};
   Double_t MCef_ler[23] = {0.000195321,0.00020786,0.000266961,0.000283724,0.00041444,0.00114978,0.00334904,0.00573811,0.00622272,0.0060273,0.00574782,0.00543466,0.00512538,0.00482797,0.00451478,0.0043358,0.00293732,0.00283634,0.0020571,0.00354379,0.00992244,0.0158107,0.0457776,};
   Double_t MCef_her[23] = {0.000195321,0.00020786,0.000266961,0.000283724,0.00041444,0.00114978,0.00334904,0.00573811,0.00622272,0.0060273,0.00574782,0.00543466,0.00512538,0.00482797,0.00451478,0.0043358,0.00293732,0.00283634,0.0020571,0.00354379,0.00992244,0.0158107,0.0457776,};
   Double_t Dataef_val[23] = {0.000239688,0.000464253,0.0011102,0.00167982,0.00400404,0.0211407,0.156278,0.456415,0.605661,0.660409,0.707781,0.744914,0.77146,0.78828,0.798916,0.80841,0.823724,0.839533,0.864192,0.879026,0.905811,0.931431,0.961123,};
   Double_t Dataef_ler[23] = {7.22773e-05,9.28721e-05,0.000133726,0.000154118,0.000221191,0.000481436,0.00130847,0.00235084,0.0026736,0.00266432,0.00263386,0.00255847,0.00246378,0.00235665,0.00224873,0.00217672,0.00149414,0.00145047,0.00106249,0.00171859,0.00399478,0.00587738,0.0160632,};
   Double_t Dataef_her[23] = {7.22773e-05,9.28721e-05,0.000133726,0.000154118,0.000221191,0.000481436,0.00130847,0.00235084,0.0026736,0.00266432,0.00263386,0.00255847,0.00246378,0.00235665,0.00224873,0.00217672,0.00149414,0.00145047,0.00106249,0.00171859,0.00399478,0.00587738,0.0160632,};


   Double_t MCef_val2[23] = {0.00354477,0.00360421,0.00604409,0.00794482,0.0259691,0.122205,0.330704,0.514809,0.589872,0.627492,0.660362,0.685944,0.69623,0.713623,0.720514,0.732829,0.75323,0.778717,0.792963,0.803348,0.83766,0.890847,0.907212,};
   Double_t MCef_ler2[23] = {0.000870436,0.000848424,0.000992059,0.00125821,0.00221879,0.00465098,0.00788327,0.00988514,0.0101025,0.010107,0.00959839,0.00929215,0.00867984,0.00829256,0.00798496,0.00773524,0.00540452,0.00538978,0.00406367,0.00715849,0.0194731,0.0336991,0.0866607,};
   Double_t MCef_her2[23] = {0.000870436,0.000848424,0.000992059,0.00125821,0.00221879,0.00465098,0.00788327,0.00988514,0.0101025,0.010107,0.00959839,0.00929215,0.00867984,0.00829256,0.00798496,0.00773524,0.00540452,0.00538978,0.00406367,0.00715849,0.0194731,0.0336991,0.0866607,};
   Double_t Dataef_val2[23] = {0.00087073,0.00106339,0.00176339,0.00300109,0.00596101,0.0232854,0.10179,0.262146,0.422139,0.501698,0.55174,0.584232,0.616766,0.638883,0.658989,0.6743,0.693436,0.716966,0.740468,0.751981,0.788377,0.827881,0.855639,};
   Double_t Dataef_ler2[23] = {0.000241602,0.000250777,0.000302686,0.000369963,0.00049145,0.000916873,0.001895,0.00304998,0.00386012,0.00408959,0.00411385,0.00403139,0.0039421,0.00384151,0.00371872,0.00365534,0.0025758,0.00259683,0.00201247,0.00336314,0.00755386,0.0115513,0.0345514,};
   Double_t Dataef_her2[23] = {0.000241602,0.000250777,0.000302686,0.000369963,0.00049145,0.000916873,0.001895,0.00304998,0.00386012,0.00408959,0.00411385,0.00403139,0.0039421,0.00384151,0.00371872,0.00365534,0.0025758,0.00259683,0.00201247,0.00336314,0.00755386,0.0115513,0.0345514,};

    */



    /*
     //2017 
     //
   int n_bins = 27;
   //Double_t pt_val[27] = {20.5,21.5,22.5,23.5,24.5,25.5,26.5,27.5,28.5,29.5,30.5,31.5,32.5,33.5,34.5,35.5,36.5,37.5,38.5,39.5,41,43,45,48,55,80,150,};
   //Double_t pt_ler[27] = {0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,1,1,1,2,5,20,50,};
   double pt_bins[]=  {20, 21, 22, 23, 24, 25, 26, 27., 28., 29., 30., 31., 32., 33., 34., 35., 36, 37, 38, 39, 40,42,44, 46, 50,60,100, 200};  
   Double_t MCef_val[27] = {4.22551e-05,0.000159371,7.79267e-05,0.000166262,0.000279648,0.000252535,0.000212932,0.000137789,0.000543845,0.000495687,0.000817054,0.00170861,0.00401351,0.0195537,0.147683,0.537502,0.817692,0.889573,0.905842,0.908882,0.909645,0.912672,0.909975,0.91534,0.925829,0.947691,0.963884,};
   Double_t MCef_ler[27] = {4.22569e-05,7.25498e-05,5.62284e-05,6.86316e-05,9.228e-05,7.95749e-05,7.47827e-05,7.08313e-05,9.90892e-05,0.000109577,0.000119295,0.000164001,0.000235084,0.000514353,0.00143565,0.00296819,0.0036981,0.00363019,0.00341673,0.0032066,0.00219289,0.00230597,0.00314423,0.00502195,0.00768122,0.0125077,0.0334283,};
   Double_t MCef_her[27] = {4.22569e-05,7.25498e-05,5.62284e-05,6.86316e-05,9.228e-05,7.95749e-05,7.47827e-05,7.08313e-05,9.90892e-05,0.000109577,0.000119295,0.000164001,0.000235084,0.000514353,0.00143565,0.00296819,0.0036981,0.00363019,0.00341673,0.0032066,0.00219289,0.00230597,0.00314423,0.00502195,0.00768122,0.0125077,0.0334283,};
   Double_t Dataef_val[27] = {0.000109132,0.000149726,0.000180538,0.000203388,0.000244445,0.000309704,0.000265659,0.000340011,0.000492874,0.000612519,0.000753193,0.00112669,0.00217719,0.00428167,0.0263052,0.225939,0.601111,0.793953,0.847761,0.86034,0.865939,0.86842,0.867012,0.870024,0.88581,0.909094,0.918751,};
   Double_t Dataef_ler[27] = {4.88081e-05,5.294e-05,5.44392e-05,5.43632e-05,5.60865e-05,5.96118e-05,5.21068e-05,5.5907e-05,6.36454e-05,6.72533e-05,7.08811e-05,8.20008e-05,0.000108037,0.000143507,0.000340064,0.00102757,0.00180031,0.0020656,0.00205448,0.00198078,0.00138542,0.00148237,0.00197736,0.00278083,0.00378312,0.00555599,0.0148102,};
   Double_t Dataef_her[27] = {4.88081e-05,5.294e-05,5.44392e-05,5.43632e-05,5.60865e-05,5.96118e-05,5.21068e-05,5.5907e-05,6.36454e-05,6.72533e-05,7.08811e-05,8.20008e-05,0.000108037,0.000143507,0.000340064,0.00102757,0.00180031,0.0020656,0.00205448,0.00198078,0.00138542,0.00148237,0.00197736,0.00278083,0.00378312,0.00555599,0.0148102,};


   Double_t pt_val2[27] = {20.5,21.5,22.5,23.5,24.5,25.5,26.5,27.5,28.5,29.5,30.5,31.5,32.5,33.5,34.5,35.5,36.5,37.5,38.5,39.5,41,43,45,48,55,80,150,};
   Double_t pt_ler2[27] = {0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,1,1,1,2,5,20,50,};
   Double_t pt_her2[27] = {0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,1,1,1,2,5,20,50,};
   Double_t MCef_val2[27] = {0.000719814,0.000378526,0.000857279,0.000885783,0.000863485,0.00103095,0.00174902,0.00219683,0.00183514,0.00325116,0.00360782,0.0128292,0.0460505,0.150385,0.369568,0.62863,0.804202,0.876431,0.894769,0.901434,0.90528,0.90879,0.904297,0.905194,0.926003,0.9468,0.977276,};
   Double_t MCef_ler2[27] = {0.000326596,0.000315292,0.000264642,0.000371208,0.00033222,0.000366411,0.000397414,0.000376948,0.000414868,0.000441353,0.000473609,0.000858865,0.00162346,0.00290379,0.00472183,0.00637368,0.00696192,0.0068944,0.00656981,0.00620503,0.00428885,0.00455098,0.00588214,0.00833088,0.0142737,0.0250902,0.0692015,};
   Double_t MCef_her2[27] = {0.000326596,0.000315292,0.000264642,0.000371208,0.00033222,0.000366411,0.000397414,0.000376948,0.000414868,0.000441353,0.000473609,0.000858865,0.00162346,0.00290379,0.00472183,0.00637368,0.00696192,0.0068944,0.00656981,0.00620503,0.00428885,0.00455098,0.00588214,0.00833088,0.0142737,0.0250902,0.0227244,};
   Double_t Dataef_val2[27] = {0.000689309,0.000613429,0.000401345,0.000829455,0.00115464,0.00139291,0.00172332,0.00255269,0.00201796,0.00244766,0.00263084,0.00313271,0.00379933,0.00828019,0.026787,0.116027,0.334203,0.563548,0.701224,0.7746,0.824995,0.849235,0.853496,0.858228,0.87139,0.893831,0.916054,};
   Double_t Dataef_ler2[27] = {0.000207906,0.000185012,0.000141925,0.000195585,0.000218332,0.000229153,0.000241521,0.000282257,0.00023973,0.000252766,0.000247814,0.000259671,0.000271896,0.000383515,0.000660464,0.00136319,0.00240556,0.00321419,0.00355206,0.00364871,0.00266262,0.00292552,0.00375398,0.0050183,0.00720591,0.0111369,0.0327947,};
   Double_t Dataef_her2[27] = {0.000207906,0.000185012,0.000141925,0.000195585,0.000218332,0.000229153,0.000241521,0.000282257,0.00023973,0.000252766,0.000247814,0.000259671,0.000271896,0.000383515,0.000660464,0.00136319,0.00240556,0.00321419,0.00355206,0.00364871,0.00266262,0.00292552,0.00375398,0.0050183,0.00720591,0.0111369,0.0327947,};

    */

    ///*
    //2018
    
    int n_bins = 23;
   //Double_t pt_val[23] = {20.5,21.5,22.5,23.5,24.5,25.5,26.5,27.5,28.5,29.5,30.5,31.5,32.5,33.5,34.5,35.5,37,39,42,47,55,80,150,};
   //Double_t pt_ler2[23] = {0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,1,1,2,3,5,20,50,};
    double pt_bins[]=  {20, 21, 22, 23, 24, 25, 26, 27., 28., 29., 30., 31., 32., 33., 34., 35., 36,38,40,44,50,60,100, 200};  
    
    
   Double_t MCef_val[23] = {9.83609e-05,5.52251e-05,0.000167492,0.000302233,0.000436549,0.000562347,0.000713566,0.000874327,0.00169732,0.00236617,0.00896227,0.0774811,0.434948,0.799223,0.893536,0.910005,0.918174,0.923328,0.923853,0.925497,0.937112,0.951773,0.97539,};
   Double_t MCef_ler[23] = {8.02094e-05,8.95577e-05,0.000104546,0.000101014,0.000112906,0.000117683,0.000133783,0.00014312,0.000174041,0.000205506,0.000398708,0.00117206,0.00304559,0.0043502,0.0043935,0.00413618,0.00260731,0.0022683,0.0015566,0.00274294,0.00750595,0.0117252,0.0319333,};
   Double_t MCef_her[23] = {8.02094e-05,8.95577e-05,0.000104546,0.000101014,0.000112906,0.000117683,0.000133783,0.00014312,0.000174041,0.000205506,0.000398708,0.00117206,0.00304559,0.0043502,0.0043935,0.00413618,0.00260731,0.0022683,0.0015566,0.00274294,0.00750595,0.0117252,0.0246102,};
   Double_t Dataef_val[23] = {0.000181205,0.000169315,0.000189825,0.000215297,0.000464414,0.000486859,0.000840147,0.00080825,0.00142451,0.00226916,0.00432908,0.0268089,0.258799,0.676945,0.834825,0.867451,0.881017,0.886787,0.890777,0.893889,0.907465,0.925886,0.937495,};
   Double_t Dataef_ler[23] = {5.02617e-05,4.52552e-05,4.47465e-05,4.48974e-05,6.20744e-05,5.99427e-05,7.45823e-05,6.90814e-05,8.70777e-05,0.000104015,0.000136042,0.000325439,0.00105666,0.00186097,0.00204503,0.00198611,0.00130359,0.00118164,0.000844887,0.00140539,0.00317004,0.00459469,0.0122224,};
   Double_t Dataef_her[23] = {5.02617e-05,4.52552e-05,4.47465e-05,4.48974e-05,6.20744e-05,5.99427e-05,7.45823e-05,6.90814e-05,8.70777e-05,0.000104015,0.000136042,0.000325439,0.00105666,0.00186097,0.00204503,0.00198611,0.00130359,0.00118164,0.000844887,0.00140539,0.00317004,0.00459469,0.0122224,};

   Double_t MCef_val2[23] = {0.000577734,0.000636258,0.000710151,0.00149826,0.00176314,0.00212461,0.00237359,0.00389613,0.00514316,0.023462,0.101685,0.311918,0.601825,0.795526,0.873947,0.893292,0.9051,0.908212,0.91264,0.915049,0.933934,0.949487,0.962537,};
   Double_t MCef_ler2[23] = {0.000309394,0.000348419,0.000409561,0.000453442,0.00041432,0.000461011,0.000529124,0.000529752,0.000679415,0.00144454,0.00284465,0.00528724,0.00767756,0.00876707,0.00876165,0.00835826,0.00540306,0.00467187,0.0031737,0.00469311,0.0139522,0.023136,0.0672526,};
   Double_t MCef_her2[23] = {0.000309394,0.000348419,0.000409561,0.000453442,0.00041432,0.000461011,0.000529124,0.000529752,0.000679415,0.00144454,0.00284465,0.00528724,0.00767756,0.00876707,0.00876165,0.00835826,0.00540306,0.00467187,0.0031737,0.00469311,0.0139522,0.023136,0.0374626,};
   Double_t Dataef_val2[23] = {0.00106662,0.00112875,0.00156209,0.00191727,0.00225297,0.00272079,0.0032911,0.0041354,0.00477889,0.00576184,0.0110158,0.0440408,0.204172,0.522939,0.74948,0.834506,0.87287,0.887547,0.895294,0.898743,0.913969,0.932422,0.939024,};
   Double_t Dataef_ler2[23] = {0.000209293,0.000202844,0.000225645,0.000236225,0.000244644,0.000256299,0.000266507,0.00028596,0.000292614,0.000308429,0.000406898,0.000788022,0.00173749,0.00296043,0.00361191,0.00369907,0.00249679,0.00228051,0.00158871,0.00227753,0.00559937,0.00866701,0.0248354,};
   Double_t Dataef_her2[23] = {0.000209293,0.000202844,0.000225645,0.000236225,0.000244644,0.000256299,0.000266507,0.00028596,0.000292614,0.000308429,0.000406898,0.000788022,0.00173749,0.00296043,0.00361191,0.00369907,0.00249679,0.00228051,0.00158871,0.00227753,0.00559937,0.00866701,0.0248354,};

    
    //*/


    TFile *fout = TFile::Open("2018/El_HLT.root", "RECREATE");
    TH2D *h_sf = new TH2D("EGamma_SF2D", "", 2,eta_bins, n_bins, pt_bins); 
    TH2D *h_data_eff = new TH2D("EGamma_DataEff", "", 2,eta_bins, n_bins, pt_bins); 
    TH2D *h_mc_eff = new TH2D("EGamma_MCEff", "", 2,eta_bins, n_bins, pt_bins); 


    for(int i=0; i<n_bins; i++){
        double d_eff = Dataef_val[i];
        double d_eff_unc = 0.5 *(Dataef_ler[i] + Dataef_her[i]);
        double mc_eff = MCef_val[i];
        double mc_eff_unc = 0.5 * (MCef_ler[i] + MCef_her[i]);

        double sf = d_eff / mc_eff;
        double sf_unc = sf * std::pow(std::pow(d_eff_unc/d_eff, 2) + std::pow(mc_eff_unc/mc_eff, 2), 0.5);

        h_sf->SetBinContent(1, i+1, sf);
        h_sf->SetBinError(1, i+1, sf_unc);
        h_data_eff->SetBinContent(1, i+1, d_eff);
        h_data_eff->SetBinError(1, i+1, d_eff_unc);
        h_mc_eff->SetBinContent(1, i+1, mc_eff);
        h_mc_eff->SetBinError(1, i+1, mc_eff_unc);

        d_eff = Dataef_val2[i];
        d_eff_unc = 0.5 *(Dataef_ler2[i] + Dataef_her2[i]);
        mc_eff = MCef_val2[i];
        mc_eff_unc = 0.5 * (MCef_ler2[i] + MCef_her2[i]);

        sf = d_eff / mc_eff;
        sf_unc = sf * std::pow(std::pow(d_eff_unc/d_eff, 2) + std::pow(mc_eff_unc/mc_eff, 2), 0.5);

        h_sf->SetBinContent(2, i+1, sf);
        h_sf->SetBinError(2, i+1, sf_unc);
        h_data_eff->SetBinError(2, i+1, d_eff_unc);
        h_mc_eff->SetBinContent(2, i+1, mc_eff);
        h_mc_eff->SetBinError(2, i+1, mc_eff_unc);


    }
    h_sf->Print("all");

    fout->cd();
    h_sf->Write();
    h_data_eff->Write();
    h_mc_eff->Write();
    fout->Close();
}

